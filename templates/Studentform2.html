{% extends 'studentBase.html' %}
{% block title %}Request{% endblock title %}

{% block body %}
  <div class="container">
    <div class="title">Additional Info</div>
    <div class="content">
      <form method="POST", action="/studentform2" , enctype='multipart/form-data'>
      {% csrf_token %}
        <div class="user-details">
          <div id="university-section">
            <div class="university-entry">
              <div class="inputs-wrapper">
                <div class="input-box">
                  <span class="details">Requesting University *</span>
                  <input type="text" placeholder="University Name" name="universities" required>
                </div>

                <div class="input-box">
                  <span class="details">Program Applied *</span>
                  <input type="text" placeholder="Program Applied" name="programs_applied" required>
                </div>

                <div class="input-box">
                  <span class="details">Deadline *</span>
                  <input type="date" name="deadlines" required>
                </div>
              </div>
            </div>
          </div>

          <!-- Add button -->
          <div>
            <button type="button" class="add-university-btn" onclick="addUniversity()">+ Add Another University</button>
          </div>

          <div class="input-box">
            <span class="details">GPA: *</span>
            <input type="text" name="gpa" required>
          </div>

          <div class="input-box">
            <span class="details">Tentative Ranking *</span>
            <div style="display: flex; align-items: center; gap: 10px;">
              <select name="tentative_ranking" id="rankSelect" required>
                <option></option>
                <option>Batch Topper</option>
                <option>Top 5%</option>
                <option>Top 10%</option>
                <option>Top 20%</option>
                <option>Top 30%</option>
                <option>Top 40%</option>
              </select>

              <input type="text" name="tentative_ranking" id="rankCustomInput" placeholder="Enter custom ranking" style="display: none;" />

              <button type="button" onclick="toggleRankInput()" title="Enter custom value"
                style="background: none; border: none; cursor: pointer; padding: 0; display: flex; align-items: center;">
                <!-- Simple black pencil SVG -->
                <svg width="16" height="16" viewBox="0 0 16 16" fill="black" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12.146 0.146a.5.5 0 01.708 0l3 3a.5.5 0 010 .708l-9.5 9.5a.5.5 0 01-.168.11l-5 2a.5.5 0 01-.65-.65l2-5a.5.5 0 01.11-.168l9.5-9.5zM11.207 3L13 4.793 14.293 3.5 12.5 1.707 11.207 3zm1.586 2L11 3.207 4 10.207V11h.793l7-7zM3.5 11.5l-.5 1.293L4.207 12l-1.293-.5z"/>
                </svg>
              </button>
            </div>
          </div>


          <div class="input-box">
              <span class="details">Transcript *</span>
              <input type="file" name="transcript" accept=".pdf, .doc, .docx" required>
              <small style="color: #777; font-size: 12px;">Max size: 5MB</small>
          </div>

            <div class="input-box">
                <span class="details">Recent CV *</span>
                  <input type="file" name="cv" accept=".pdf, .doc, .docx" required>
                  <small style="color: #777; font-size: 12px;">Max size: 5MB</small>
                </div>
                
                <div class="input-box">
                  <span class="details">Photo *</span>
                  <input type="file" name="photo" accept=".jpg, .jpeg, .png"  required>
                  <small style="color: #777; font-size: 12px;">Max size: 3MB</small>
                </div>
                
                <!-- <div class="input-box">
                  <span class="details">Presentation skills:</span>
                  <select name="presentation" required>
                    <option></option>
                    <option>good</option>
                    <option>outstanding</option>
                    <option>excellent</option>
                  </select>
                </div> -->
                
              <style>
                .input-box textarea {
                  width: 150%;
                  padding: 10px;
                  border: 1px solid #ccc;
                  border-radius: 5px;
                  font-size: 16px;
                  resize: vertical; /* Allows the user to resize the textarea vertically but not horizontally */
                }
              </style>
              
              <div class="input-box">
                <span class="details">Extracurricular Activities *</span>
                <textarea name="eca" rows="5" required></textarea>
              </div>
             
              <!-- <div class="input-box">
                <span class="details">Qualitiy:</span>
                <select name="qual" required>
                  <option></option>
                  <option>sincere and hardworking</option>
                  <option>confident and responsible</option>
                  <option>diligent and competitive</option>
                </select>
              </div> -->
      
              <!-- <div class="input-box">
                <span class="details">Project Details</span>
                <input type="text" name="quality3" />
              </div> -->
          
      
              <!-- <div class="gender-details">
                <span class="gender-title">Personal Qualities</span>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="quality1" id="flexCheckDefault" />
                  <label class="form-check-label" for="flexCheckDefault">
                    Leadership
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="quality2" id="flexCheckDefault" />
                  <label class="form-check-label" for="flexCheckDefault">
                    Hardworking
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="quality3" id="flexCheckDefault" />
                  <label class="form-check-label" for="flexCheckDefault">
                    Social
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="quality4" id="flexCheckDefault" />
                  <label class="form-check-label" for="flexCheckDefault">
                    Teamwork
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="quality5" id="flexCheckDefault" />
                  <label class="form-check-label" for="flexCheckDefault">
                    Friendly
                  </label>
                </div>
              </div> -->
                
        <div class="input-box">
          <input type="hidden" value="{{roll}}" name="roll" readonly>
        </div>

        <div class="input-box">
          <input type="hidden" value="{{naam}}" name="naam" readonly>
        </div>

        <div class="input-box">
          <input type="hidden" value="{{prof_name}}" name="prof_name" readonly>
        </div>


          <div class="button">
            <input type="submit" value="  Submit  " />
          </div>
      </form>
    </div>
  </div>

  
  <script>
    // Set the maximum allowed file sizes (in bytes)
    const maxTranscriptSize = 5 * 1024 * 1024;  // 5MB
    const maxCVSize = 5 * 1024 * 1024;         // 5MB
    const maxPhotoSize = 3 * 1024 * 1024;      // 3MB

    // Get the form and submit button
    const form = document.querySelector("form");
    const submitBtn = document.querySelector("input[type='submit']");

    // Listen for form submission
    form.addEventListener("submit", function(event) {
        // Get the files from the input fields
        const transcriptFile = document.querySelector('input[name="transcript"]').files[0];
        const cvFile = document.querySelector('input[name="cv"]').files[0];
        const photoFile = document.querySelector('input[name="photo"]').files[0];

        // Check the size of the transcript file
        if (transcriptFile && transcriptFile.size > maxTranscriptSize) {
            alert("Transcript file size exceeds the 5MB limit.");
            event.preventDefault();  // Prevent form submission
            return;
        }

        // Check the size of the CV file
        if (cvFile && cvFile.size > maxCVSize) {
            alert("CV file size exceeds the 5MB limit.");
            event.preventDefault();  // Prevent form submission
            return;
        }

        // Check the size of the photo file
        if (photoFile && photoFile.size > maxPhotoSize) {
            alert("Photo file size exceeds the 3MB limit.");
            event.preventDefault();  // Prevent form submission
            return;
        }

        // If all files are within size limits, allow form submission
    });

    function toggleRankInput() {
    const select = document.getElementById('rankSelect');
    const input = document.getElementById('rankCustomInput');

    const usingCustom = input.style.display === 'inline-block';

    if (usingCustom) {
      input.style.display = 'none';
      input.value = '';
      select.style.display = 'inline-block';
      select.required = true;
      input.required = false;
    } else {
      select.style.display = 'none';
      select.value = '';
      input.style.display = 'inline-block';
      input.required = true;
      select.required = false;
    }
  }

  function addUniversity() {
    const section = document.getElementById("university-section");
    const originalEntry = document.querySelector(".university-entry");

    // Clone the first entry
    const newEntry = originalEntry.cloneNode(true);

    // Clear input values
    newEntry.querySelectorAll("input").forEach(input => input.value = "");

    // Add remove button only to cloned entry
    const removeBtn = document.createElement("button");
    removeBtn.type = "button";
    removeBtn.className = "remove-university-btn";
    removeBtn.innerText = "Remove";
    removeBtn.onclick = function() {
      section.removeChild(newEntry);
    };

    newEntry.appendChild(removeBtn);

    // Append cloned entry
    section.appendChild(newEntry);
  }



  // Remove button function
  function removeUniversity(button) {
    const section = document.getElementById("university-section");
    const entry = button.parentElement;
    if (section.children.length > 1) {
      section.removeChild(entry);
    }
  }
</script>



{% endblock body %}