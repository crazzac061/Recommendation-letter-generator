{% extends 'base2.html' %}

{% block title %}Edit Letters{% endblock title %}
{% block body %}
<div class="a4-preview">
    <form method="POST" action="/final" style="margin-bottom:40px;">
        {% csrf_token %}
        {% for item in letters %}
        <div class="a4-paper">
            <h2 style="text-align:center;">Letter of Recommendation</h2>
            <div id="textbox{{ forloop.counter }}" name="textbox" contenteditable="true" 
                 style="white-space: pre-line; font-size: 16px; min-height: 700px; outline: 1px solid #e0e0e0; border-radius: 4px; padding: 8px;">
                {{ item.letter|safe }}
            </div>
        </div>
        {% endfor %}
        <input type="hidden" name="roll" value="{{ student.roll_number }}">
        <textarea name="letters" id="letters" hidden></textarea>
        <div class="button" style="margin-top: 24px; display: flex; justify-content: center; align-items: center; width: 95%;">
            <input type="submit" value="Submit" onclick="collectLetters()" class="cta-add">
        </div>
    </form>
</div>
<style>
.a4-preview {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    background: #f0f0f0;
    padding: 40px 0 60px 0;
}
.a4-paper {
    width: 794px;
    height: 1123px; /* Fixed height for A4 */
    background: #fff;
    box-shadow: 0 0 10px rgba(0,0,0,0.15);
    padding: 48px 60px;
    margin: 20px auto;
    border-radius: 4px;
    position: relative;
    display: flex;
    flex-direction: column;
}
</style>

<script>
    function collectLetters() {
        var letters = [];
        {% for item in letters %}
            var textbox = document.getElementById("textbox{{ forloop.counter }}");
            letters.push(textbox.innerText);
        {% endfor %}
        document.getElementById("letters").value = letters.join('\n\n---\n\n');
    }
</script>
{% endblock body %}